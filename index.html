<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <style>
  .success-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #4CAF50;
    color: white;
    font-size: 1.2rem;
    padding: 20px 40px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 9999;
  }
  .success-message.show {
    opacity: 1;
  }
</style>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>قائمة الكافيه</title>
  <style>
    :root{
      --bg:#fbf6ef; --header:#7a2a06; --accent:#ff8a00;
      --drink-bg:#e0f2fe; --drink-color:#0369a1;
      --snack-bg:#ede9fe; --snack-color:#6d28d9;
    }
    *{box-sizing:border-box}
    body<div id="successMessage" class="success-message">✅ تم تأكيد الطلب بنجاح!</div>

    {margin:0;font-family:'Tajawal','Segoe UI',sans-serif;background:var(--bg);color:#111}

    .container{max-width:1200px;margin:16px auto;padding:12px}
    header{background:linear-gradient(180deg,var(--header),#6a2304);color:#fff;padding:18px;border-radius:8px;position:relative}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:56px;height:56px;border-radius:50%;background:rgba(255,255,255,0.08);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:22px}
    h1{margin:0;font-size:22px}
    .controls{position:absolute;left:14px;top:14px;display:flex;align-items:center;gap:10px}
    .cartBtn,.confirmMain{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;color:#fff}
    .cartBtn{background:rgba(255,255,255,0.12)}
    .confirmMain{background:#10b981;box-shadow:0 6px 18px rgba(16,185,129,0.18)}
    .badge{background:#ff3b30;color:#fff;border-radius:50%;padding:5px 8px;font-weight:700}

    .searchWrap{margin-top:12px}
    .search{width:100%;padding:12px;border-radius:10px;border:0;box-shadow:0 6px 16px rgba(11,15,23,0.08);font-size:15px}

    .filters{display:flex;gap:10px;margin:12px 0}
    .btnFilter{background:transparent;border:0;padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.06);color:#fff;cursor:pointer}
    .btnFilter.active{background:#fff;color:var(--header);box-shadow:0 6px 14px rgba(11,15,23,0.06)}

    main.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:18px;margin-top:12px}
    .card{background:#fff;border-radius:12px;padding:16px 16px 20px;box-shadow:0 8px 20px rgba(11,15,23,0.06);position:relative}
    .stripe{position:absolute;left:0;top:0;height:10px;width:100%;border-top-left-radius:12px;border-top-right-radius:12px;background:linear-gradient(90deg,#ffecd2,#fcb69f)}
    .name{font-size:18px;font-weight:800;margin:6px 0;text-align:right}
    .category-label{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;font-weight:700;font-size:13px;margin-top:6px;direction:rtl}
    .category-label.drink{background:var(--drink-bg);color:var(--drink-color)}
    .category-label.snack{background:var(--snack-bg);color:var(--snack-color)}
    .priceRow{display:flex;align-items:center;justify-content:space-between;margin-top:14px}
    .price{font-size:18px;color:var(--header);font-weight:800}
    .addBtn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px;border:0;cursor:pointer}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:20px;z-index:60}
    .modal{width:720px;max-width:96%;background:#fff;border-radius:12px;padding:18px;box-shadow:0 20px 60px rgba(2,6,23,0.4);position:relative}
    .modal h2{margin:0;font-size:20px}
    .modal .close{position:absolute;top:12px;left:12px;background:transparent;border:0;font-size:20px;cursor:pointer}
    .order-list{max-height:320px;overflow:auto;margin:14px 0;padding-right:6px}
    .order-item{display:flex;justify-content:space-between;align-items:center;background:#fafafa;padding:10px;border-radius:10px;margin-bottom:8px;gap:8px}
    .order-left{display:flex;flex-direction:column;align-items:flex-end}
    .qty-controls{display:flex;align-items:center;gap:6px}
    .qty-controls button{padding:4px 8px;border-radius:6px;border:0;background:#eee;cursor:pointer}
    .remove{background:transparent;border:0;color:#ef4444;font-weight:700;cursor:pointer}
    .summary{background:#ecfdf5;padding:12px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;margin:12px 0}
    .nameInput{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e6e6}
    .confirmOrder{background:#10b981;color:#fff;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;width:100%;font-weight:700}

    @media (max-width:640px){
      .name{font-size:16px}
      .price{font-size:16px}
      .modal{padding:12px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">☕</div>
        <div>
          <h1>قائمة الكافيه</h1>
        </div>
      </div>

      <div class="controls">
        <button id="cartBtn" class="cartBtn">السلة <span class="badge" id="badge">0</span></button>
        <button id="openOrder" class="confirmMain">تأكيد الطلب</button>
      </div>

      <div class="searchWrap">
        <input id="search" class="search" placeholder="ابحث عن مشروب أو سناك..." />
      </div>

      <div class="filters">
        <button class="btnFilter active" data-cat="all">الكل</button>
        <button class="btnFilter" data-cat="مشروبات">المشروبات</button>
        <button class="btnFilter" data-cat="سناكس">السناكس</button>
      </div>
    </header>

    <main id="grid" class="grid"></main>
  </div>

  <!-- Modal -->
  <div id="backdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <button class="close" id="closeModal">✕</button>
      <h2>إتمام الطلب</h2>
      <p style="color:#6b7280;margin-top:6px">يرجى مراجعة طلبك وإدخال اسمك</p>

      <div class="order-list" id="orderList"></div>

      <div class="summary">
        <div style="font-weight:800">الإجمالي:</div>
        <div id="totalPrice" style="font-size:18px;color:#059669;font-weight:900">0 جنية</div>
      </div>

      <label style="display:block;margin-bottom:8px">الاسم</label>
      <input id="customerName" class="nameInput" placeholder="أدخل اسمك" />

      <div style="margin-top:12px">
        <button id="confirmOrder" class="confirmOrder">تأكيد الطلب</button>
      </div>
    </div>
  </div>

  <script>
    // ************ قمنا بتحديث هذا الرابط حسب ما أرسلته ************
    const GSA_URL = "https://script.google.com/macros/s/AKfycbxYRh0jds9p2R2VXCbz2-bmQ6NGqKrjCFC4gGarivfJI1RLZlDj6pGKYm4LfLx3mUuGrQ/exec";

    const menu = [
      {name:'كوفي بريك 2/1',cat:'مشروبات',price:25},
      {name:'كوفي بريك3/1',cat:'مشروبات',price:25},
      {name:'كابتشينو موكا بونجورنو',cat:'مشروبات',price:30},
      {name:'كابتشينو بندق',cat:'مشروبات',price:30},
      {name:'كابتشينوموكا بريك',cat:'مشروبات',price:30},
      {name:'مشروب كاكاو',cat:'مشروبات',price:20},
      {name:'قرفه',cat:'مشروبات',price:15},
      {name:'ينسون ليمون',cat:'مشروبات',price:15},
      {name:'جنزبيل',cat:'مشروبات',price:15},
      {name:'قهوه بندق',cat:'مشروبات',price:30},
      {name:'شاي فتله',cat:'مشروبات',price:10},
      {name:'شاي',cat:'مشروبات',price:10},
      {name:'قهوه ساده',cat:'مشروبات',price:25},
      {name:'قهوه وسط',cat:'مشروبات',price:25},
      {name:'قهوه فاتح',cat:'مشروبات',price:25},
      {name:'قهوه اسبيرسو',cat:'مشروبات',price:30},
      {name:'سن توب برتقال',cat:'مشروبات',price:15},
      {name:'سن توب مانجا',cat:'مشروبات',price:15},
      {name:'سن توب ليمون',cat:'مشروبات',price:15},
      {name:'جهينه جوافه',cat:'مشروبات',price:10},
      {name:'جهينه تفاح',cat:'مشروبات',price:10},
      {name:'في كولا',cat:'مشروبات',price:15},
      {name:'في كولا توت',cat:'مشروبات',price:15},
      {name:'تويست',cat:'مشروبات',price:15},
      {name:'سباتس برتقال',cat:'مشروبات',price:12},
      {name:'مياه',cat:'مشروبات',price:6},
      {name:'نعناع',cat:'مشروبات',price:15},
      {name:'كركديه',cat:'مشروبات',price:10},
      {name:'ليمون نعناع',cat:'مشروبات',price:15},
      {name:'في كولا سفن',cat:'مشروبات',price:15},
      {name:'عصير مكس جهينه',cat:'مشروبات',price:15},

      {name:'كبك كيك تودو',cat:'سناكس',price:15},
      {name:'كبك كيك ريد',cat:'سناكس',price:15},
      {name:'هوهوز شيكولاته',cat:'سناكس',price:10},
      {name:'هوهوز فراوله',cat:'سناكس',price:10},
      {name:'هوهوز كريمه',cat:'سناكس',price:10},
      {name:'تودو بومب',cat:'سناكس',price:15},
      {name:'تودو براوني',cat:'سناكس',price:15},
      {name:'توينكز ش وك',cat:'سناكس',price:10},
      {name:'توينكز ف وك',cat:'سناكس',price:10},
      {name:'توينكز سوبر ش',cat:'سناكس',price:10},
      {name:'توينكزسوبر ف',cat:'سناكس',price:10},
      {name:'توينكز دبل ك',cat:'سناكس',price:10},
      {name:'توينكز ايسنج',cat:'سناكس',price:10},
      {name:'توينكز دبل ك س',cat:'سناكس',price:10},
      {name:'هوهوز ش كبير',cat:'سناكس',price:10},
      {name:'شيبسي روو',cat:'سناكس',price:15},
      {name:'بيك رولز ك',cat:'سناكس',price:10},
      {name:'بيك رولز جبنه',cat:'سناكس',price:10},
      {name:'بيك رولز شطه',cat:'سناكس',price:10},
      {name:'فرسكا فنجرز',cat:'سناكس',price:10},
      {name:'فرسكا ستكس',cat:'سناكس',price:5},
      {name:'اونيرو شوكو لافا',cat:'سناكس',price:10},
      {name:'اونيرو لوتس',cat:'سناكس',price:10},
      {name:'اونيرو بيضاء',cat:'سناكس',price:10},
      {name:'اونيرو ساده',cat:'سناكس',price:10},
      {name:'فرسكا ش',cat:'سناكس',price:10},
      {name:'فريسكا بلوك',cat:'سناكس',price:8},
      {name:'مولتو شكولاته',cat:'سناكس',price:10},
      {name:'مولتو فراوله',cat:'سناكس',price:10},
      {name:'مولتو ميكس',cat:'سناكس',price:10},
      {name:'فيشار بيتزا',cat:'سناكس',price:10},
      {name:'فيشار جبنه',cat:'سناكس',price:10},
      {name:'فيشار جبنه متبله',cat:'سناكس',price:10},
      {name:'فيشار طماطم',cat:'سناكس',price:10},
      {name:'فيشار شطه',cat:'سناكس',price:10},
      {name:'فيشار باربكيو',cat:'سناكس',price:10},
      {name:'سناكس',cat:'سناكس',price:10},
      {name:'شيبسي soul ملح',cat:'سناكس',price:10},
      {name:'اندومي كبير',cat:'سناكس',price:10},
      {name:'اندومي صغير',cat:'سناكس',price:5}
    ];

    // DOM refs
    const grid = document.getElementById('grid');
    const search = document.getElementById('search');
    const filters = document.querySelectorAll('.btnFilter');
    const badge = document.getElementById('badge');
    const cartBtn = document.getElementById('cartBtn');
    const openOrder = document.getElementById('openOrder');
    const backdrop = document.getElementById('backdrop');
    const orderList = document.getElementById('orderList');
    const totalPriceEl = document.getElementById('totalPrice');
    const customerName = document.getElementById('customerName');
    const confirmOrder = document.getElementById('confirmOrder');
    const closeModal = document.getElementById('closeModal');

    // cart structure: [{name, price, cat, qty}]
    let cart = [];

    // render products
    function createCard(it){
      const card = document.createElement('article');
      card.className = 'card';

      const stripe = document.createElement('div'); stripe.className='stripe';
      const name = document.createElement('div'); name.className='name'; name.textContent = it.name;
      const cat = document.createElement('div'); cat.className = 'category-label ' + (it.cat === 'مشروبات' ? 'drink' : 'snack');
      cat.innerHTML = it.cat === 'مشروبات' ? '☕ مشروبات' : '🍪 سناكس';
      const priceRow = document.createElement('div'); priceRow.className='priceRow';
      const price = document.createElement('div'); price.className='price'; price.textContent = it.price + ' جنية';
      const add = document.createElement('button'); add.className='addBtn'; add.textContent='أضف';
      add.onclick = ()=> addToCart(it);
      priceRow.append(price, add);
      card.append(stripe, name, cat, priceRow);
      return card;
    }

    function render(list){
      grid.innerHTML = '';
      list.forEach(i => grid.appendChild(createCard(i)));
    }

    render(menu);

    // search & filters
    search.addEventListener('input', ()=> {
      const q = search.value.trim().toLowerCase();
      render(menu.filter(i => (i.name.toLowerCase().includes(q) || i.cat.includes(q))));
    });

    filters.forEach(btn => btn.addEventListener('click', ()=> {
      filters.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const cat = btn.dataset.cat;
      if(cat === 'all') render(menu); else render(menu.filter(i => i.cat === cat));
    }));

    // cart functions
    function addToCart(item){
      const idx = cart.findIndex(c => c.name === item.name);
      if(idx >= 0){
        cart[idx].qty += 1;
      } else {
        cart.push({name: item.name, price: Number(item.price), cat: item.cat, qty: 1});
      }
      badge.textContent = cart.reduce((s,i)=>s+i.qty,0);
    }

    function openModal(){
      populateOrder();
      backdrop.style.display = 'flex';
      backdrop.setAttribute('aria-hidden','false');
    }
    function closeModalFn(){
      backdrop.style.display = 'none';
      backdrop.setAttribute('aria-hidden','true');
    }

    cartBtn.addEventListener('click', openModal);
    openOrder.addEventListener('click', openModal);
    closeModal.addEventListener('click', closeModalFn);
    backdrop.addEventListener('click', (e)=> { if(e.target === backdrop) closeModalFn(); });

    function populateOrder(){
      orderList.innerHTML = '';
      if(cart.length === 0){
        orderList.innerHTML = '<div style="padding:12px;color:#6b7280">السلة فارغة</div>';
        totalPriceEl.textContent = '0 جنية';
        return;
      }
      let sum = 0;
      cart.forEach((it, idx) => {
        const row = document.createElement('div'); row.className = 'order-item';
        const left = document.createElement('div'); left.className = 'order-left';
        left.innerHTML = `<div style="font-weight:700">${it.name}</div><div style="color:#6b7280;font-size:13px">${it.price} جنية</div>`;

        const controls = document.createElement('div');
        controls.style.display = 'flex';
        controls.style.alignItems = 'center';
        controls.style.gap = '8px';

        const qtyControls = document.createElement('div'); qtyControls.className='qty-controls';
        const minus = document.createElement('button'); minus.textContent='-';
        const qty = document.createElement('span'); qty.textContent = it.qty; qty.style.minWidth='22px'; qty.style.display='inline-block'; qty.style.textAlign='center';
        const plus = document.createElement('button'); plus.textContent='+';
        minus.onclick = ()=> { if(it.qty>1) { it.qty--; badge.textContent = cart.reduce((s,i)=>s+i.qty,0); populateOrder(); } };
        plus.onclick = ()=> { it.qty++; badge.textContent = cart.reduce((s,i)=>s+i.qty,0); populateOrder(); };
        qtyControls.append(minus, qty, plus);

        const remove = document.createElement('button'); remove.className='remove'; remove.textContent='حذف';
        remove.onclick = ()=> { cart.splice(idx,1); badge.textContent = cart.reduce((s,i)=>s+i.qty,0); populateOrder(); };

        controls.append(qtyControls, remove);

        row.append(left, controls);
        orderList.appendChild(row);
        sum += it.price * it.qty;
      });
      totalPriceEl.textContent = sum + ' جنية';
    }

    confirmOrder.addEventListener('click', () => {
  if (cart.length === 0) return; // لو السلة فاضية ما يعمل شيء

  const name = customerName.value.trim() || "بدون اسم";
  const total = cart.reduce((sum, item) => sum + item.price * item.qty, 0);
  const details = cart.map(i => `${i.qty}× ${i.name} (${i.price}ج)` ).join(' | ');

  const form = new FormData();
  form.append('name', name);
  form.append('details', details);
  form.append('total', total);

  // دالة لعرض رسالة نجاح لطيفة
  function showSuccess() {
    const msg = document.getElementById('successMessage');
    msg.classList.add('show');
    setTimeout(() => msg.classList.remove('show'), 1500);
  }

  // إرسال الطلب (بدون قراءة الرد)
  if (navigator.sendBeacon) {
    navigator.sendBeacon(GSA_URL, form);
  } else {
    fetch(GSA_URL, { method: 'POST', body: form, mode: 'no-cors' }).catch(()=>{});
  }

  // تنظيف السلة وبدء طلب جديد فورًا
  showSuccess();
  cart = [];
  badge.textContent = 0;
  customerName.value = '';
  populateOrder();
  closeModalFn();
});

    });

  </script>
</body>
</html>

