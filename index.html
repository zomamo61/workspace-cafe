<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>WorkSpace Café — اطلب الآن</title>
  <style>
    body{
      margin:0;
      font-family:"Tajawal",sans-serif;
      background:#120a07;
      color:#fff;
    }
    header{
      background:#1c120e;
      padding:10px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      position:sticky;top:0;z-index:100;
    }
    .wrap{max-width:1000px;margin:auto;padding:20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px}
    .card{background:#2a1e1a;padding:12px;border-radius:10px;text-align:center}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:10px}
    .qty-row{display:flex;justify-content:center;align-items:center;gap:10px;margin-top:8px}
    .qty-btn{background:#d4ac6e;color:#000;border:none;border-radius:8px;width:32px;height:32px;font-weight:bold;cursor:pointer}
    .qty-display{min-width:40px;font-weight:bold}
    .bottom-bar{position:fixed;left:0;right:0;bottom:0;background:#1c120e;padding:10px 16px;display:flex;justify-content:space-between;align-items:center}
    .confirm-btn{background:#d4ac6e;color:#000;border:none;border-radius:8px;padding:8px 14px;font-weight:bold;cursor:pointer}
    #orderSummaryBox{background:#241810;border-radius:12px;padding:14px;margin-top:20px;display:none}
    #orderSummaryList div{padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.1)}
    #orderSummaryList div:last-child{border-bottom:none}
  </style>
</head>
<body>

<header>
  <h2>☕ WorkSpace Café</h2>
  <input id="searchInput" placeholder="ابحث عن منتج..." style="padding:6px 10px;border-radius:8px;border:none;outline:none">
</header>

<div class="wrap">
  <h3>المشروبات</h3>
  <div id="drinksGrid" class="grid"></div>

  <h3>السناكس</h3>
  <div id="snacksGrid" class="grid"></div>

  <div id="orderSummaryBox">
    <h3>تفاصيل الطلب</h3>
    <div id="orderSummaryList"></div>
    <div id="orderTotal" style="margin-top:10px;font-weight:bold;color:#d4ac6e"></div>
    <button id="sendOrder" class="confirm-btn" style="margin-top:12px">تأكيد الإرسال إلى الكافيه</button>
  </div>
</div>

<div class="bottom-bar">
  <div>الإجمالي: <span id="totalAmount">0</span> ج.م</div>
  <button id="confirmOrder" class="confirm-btn">عرض تفاصيل الطلب</button>
</div>

<script>
/* رابط السكربت */
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbySdCfmtIGtCjT3ZdMJ4TMhaY3-D7qDN1IV5I3it153oK7gYIv7FYc6X7K8tTS4stuAPQ/exec";

/* المنتجات */
const drinks = [
  {name:"كوفي بريك 2/1", price:25, img:"https://images.unsplash.com/photo-1509042239860-f550ce710b93?q=80"},
  {name:"كوفي بريك3/1", price:25, img:"https://images.unsplash.com/photo-1509042239860-f550ce710b93?q=80"},
  {name:"كابتشينو موكا بونجورنو", price:30, img:"https://kitchen.sayidaty.net/uploads/small/bd/bd6fe84636e832188966978d0b33df89_w240_h240.jpg"},
  {name:"كابتشينو بندق", price:30, img:"https://png.pngtree.com/background/20230606/original/pngtree-cappuccino-with-hazelnuts-on-wooden-background-cappuccino-with-chocolate-powder-on-picture-image_2877924.jpg"},
  {name:"مشروب كاكاو", price:20, img:"https://kitchen.sayidaty.net/uploads/small/07/074968944610cfa33478d4624f3acf6c_w750_h750.jpg"},
  {name:"قهوه بسيطة", price:25, img:"https://i1.sndcdn.com/artworks-000219824277-bq4b2z-t500x500.jpg"},
  {name:"شاي", price:10, img:"https://ichef.bbci.co.uk/ace/ws/640/cpsprodpb/2AAE/production/_108962901_hi053405374.jpg.webp"}
];

const snacks = [
  {name:"اندومي صغير", price:5, img:"https://m.media-amazon.com/images/I/41f-8OER9bL._AC_.jpg"},
  {name:"توينكز دبل ك", price:10, img:"https://m.media-amazon.com/images/I/6144UtFOGvL._AC_SX679_.jpg"},
  {name:"بيك رولز جبنه", price:10, img:"https://m.media-amazon.com/images/I/71L42GIxo6L._UF894,1000_QL80_.jpg"},
  {name:"مولتو شيكولاتة", price:12, img:"https://cdnprod.mafretailproxy.com/sys-master-root/h58/hcf/16891898372126/1_main_600Wx600H"},
  {name:"كروسان جبنة", price:12, img:"https://cdnprod.mafretailproxy.com/sys-master-root/h3c/had/16887062593566/1_main_600Wx600H"},
  {name:"شيبسي كبير", price:20, img:"https://cdnprod.mafretailproxy.com/sys-master-root/ha3/h9a/16887090573342/1_main_600Wx600H"}
];

/* الحالة */
let cart = {};

/* DOM */
const drinksGrid=document.getElementById('drinksGrid');
const snacksGrid=document.getElementById('snacksGrid');
const totalAmountEl=document.getElementById('totalAmount');
const orderBox=document.getElementById('orderSummaryBox');
const orderList=document.getElementById('orderSummaryList');
const orderTotal=document.getElementById('orderTotal');
const confirmOrderBtn=document.getElementById('confirmOrder');
const sendOrderBtn=document.getElementById('sendOrder');

/* بناء كارت */
function createCardHTML(item){
  const id=item.name.replace(/\s+/g,'_');
  return `<div class="card" data-name="${item.name}" data-price="${item.price}">
    <img src="${item.img}" alt="${item.name}">
    <h4>${item.name}</h4>
    <div>${item.price} ج.م</div>
    <div class="qty-row">
      <button class="qty-btn" onclick="changeQty('${item.name}',-1)">−</button>
      <div class="qty-display" id="qty_${id}">0</div>
      <button class="qty-btn" onclick="changeQty('${item.name}',1)">+</button>
    </div>
  </div>`;
}

/* عرض المنتجات */
drinksGrid.innerHTML = drinks.map(createCardHTML).join('');
snacksGrid.innerHTML = snacks.map(createCardHTML).join('');

/* التحكم بالكمية */
function changeQty(name,delta){
  if(!cart[name]) cart[name]={qty:0,price:findPrice(name)};
  cart[name].qty=Math.max(0,cart[name].qty+delta);
  document.getElementById('qty_'+name.replace(/\s+/g,'_')).textContent=cart[name].qty;
  updateTotal();
}

/* إيجاد السعر */
function findPrice(name){
  return (drinks.find(x=>x.name===name)?.price)||(snacks.find(x=>x.name===name)?.price)||0;
}

/* تحديث الإجمالي */
function updateTotal(){
  let t=0;
  for(const [n,v] of Object.entries(cart)){t+=v.qty*v.price;}
  totalAmountEl.textContent=t;
}

/* عرض تفاصيل الطلب قبل التأكيد */
confirmOrderBtn.onclick=()=>{
  const lines=[];
  let total=0;
  for(const [name,v] of Object.entries(cart)){
    if(v.qty>0){
      const subtotal=v.qty*v.price;
      lines.push(`${name} × ${v.qty} — ${subtotal} ج.م`);
      total+=subtotal;
    }
  }
  if(!lines.length){alert("لم تُضف أي منتجات بعد!");return;}
  orderList.innerHTML=lines.map(l=>`<div>${l}</div>`).join('');
  orderTotal.textContent=`الإجمالي: ${total} ج.م`;
  orderBox.style.display='block';
  orderBox.scrollIntoView({behavior:'smooth'});
};

/* إرسال إلى Google Sheet (عمودي) */
sendOrderBtn.onclick=async()=>{
  const customer=prompt("أدخل اسم العميل:")||"عميل مجهول";
  const orderRows=[];
  let total=0;
  for(const [name,v] of Object.entries(cart)){
    if(v.qty>0){
      const subtotal=v.qty*v.price;
      total+=subtotal;
      orderRows.push({name,qty:v.qty,price:v.price,total:subtotal});
    }
  }
  if(!orderRows.length){alert("السلة فارغة!");return;}

  // إرسال كل منتج كصف مستقل
  for(const row of orderRows){
    const form=new FormData();
    form.append("customer",customer);
    form.append("product",row.name);
    form.append("quantity",row.qty);
    form.append("price",row.price);
    form.append("subtotal",row.total);
    form.append("orderTotal",total);
    await fetch(WEB_APP_URL,{method:"POST",body:form}).catch(console.error);
  }

  alert("✅ تم إرسال الطلب إلى جوجل شيت بنجاح!");
  orderBox.style.display='none';
  cart={};
  document.querySelectorAll('.qty-display').forEach(e=>e.textContent='0');
  updateTotal();
};
</script>

</body>
</html>
