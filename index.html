<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>WorkSpace Café — اطلب الآن</title>
<style>
  :root{--accent:#d4ac6e;--muted:#7a6b5d}
  body{font-family:"Tajawal",sans-serif;background:#f5f5f6;margin:0;padding:18px;color:#111}
  .wrap{max-width:1100px;margin:0 auto}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:14px}
  header h1{margin:0;font-size:20px;color:var(--accent)}
  .controls{display:flex;gap:8px;align-items:center}
  input[type="search"], input[type="text"]{padding:8px;border-radius:8px;border:1px solid #ddd}
  .section{margin-top:18px}
  .section h2{margin:6px 0;color:var(--accent)}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
  .card{background:#fff;border-radius:10px;padding:8px;box-shadow:0 2px 6px rgba(0,0,0,0.06);display:flex;flex-direction:column;gap:8px;align-items:center;text-align:center}
  .card img{width:100%;height:110px;object-fit:cover;border-radius:8px}
  .card .name{font-weight:700;font-size:14px}
  .card .price{color:var(--muted);font-weight:700}
  .qty-row{display:flex;align-items:center;gap:8px;margin-top:auto}
  .qty-btn{width:34px;height:34px;border-radius:8px;border:none;background:var(--accent);color:#111;font-weight:800;cursor:pointer}
  .qty-display{min-width:36px;text-align:center;font-weight:700}
  .bottom-bar{position:fixed;left:0;right:0;bottom:0;padding:12px;background:#1f1410;color:#fff;display:flex;justify-content:space-between;align-items:center;gap:12px;z-index:999}
  .btn{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;font-weight:800;cursor:pointer}
  .summary-box{background:#fff;border-radius:10px;padding:12px;margin-top:18px;box-shadow:0 2px 6px rgba(0,0,0,0.06)}
  .summary-box h3{margin-top:0}
  .hidden{display:none}
  @media(max-width:640px){ .grid{grid-template-columns:repeat(2,1fr)} .bottom-bar{flex-direction:column;align-items:stretch} }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>WorkSpace Café — اطلب الآن</h1>
    <div class="controls">
      <input id="searchInput" type="search" placeholder="ابحث عن منتج..." />
      <input id="customerName" type="text" placeholder="اسم العميل" />
      <input id="customerPhone" type="text" placeholder="رقم الهاتف" />
    </div>
  </header>

  <div class="section">
    <h2>المشروبات</h2>
    <div id="drinksGrid" class="grid"></div>
  </div>

  <div class="section">
    <h2>السناكس</h2>
    <div id="snacksGrid" class="grid"></div>
  </div>

  <!-- ملخص الطلب (يظهر بعد الضغط على "عرض التفاصيل") -->
  <div id="summaryBox" class="summary-box hidden">
    <h3>تفاصيل الطلب</h3>
    <div id="summaryList"></div>
    <div style="margin-top:10px;font-weight:800;color:var(--accent)">الإجمالي الكلي: <span id="summaryTotal">0</span> ج.م</div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button id="sendBtn" class="btn">تأكيد وإرسال الطلب</button>
      <button id="editBtn" class="btn" style="background:#999">تعديل (العودة)</button>
    </div>
  </div>
</div>

<!-- شريط سفلي -->
<div class="bottom-bar">
  <div>العناصر المختارة: <span id="itemsCount">0</span> — الإجمالي: <strong id="liveTotal">0</strong> ج.م</div>
  <div style="display:flex;gap:8px">
    <button id="viewSummary" class="btn">عرض تفاصيل الطلب</button>
    <button id="clearBtn" class="btn" style="background:#b85a3a">مسح السلة</button>
  </div>
</div>

<script>
/* === رابط Web App (انسخ رابطك هنا إن احتجت تغييره) === */
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbySdCfmtIGtCjT3ZdMJ4TMhaY3-D7qDN1IV5I3it153oK7gYIv7FYc6X7K8tTS4stuAPQ/exec";

/* === بيانات المنتجات (النسخة الكاملة كما أرسلتها) === */
const drinks = [
  {name:"كوفي بريك 2/1", price:25, img:"https://images.unsplash.com/photo-1509042239860-f550ce710b93?q=80&w=1200&auto=format&fit=crop"},
  {name:"كوفي بريك3/1", price:25, img:"https://images.unsplash.com/photo-1509042239860-f550ce710b93?q=80&w=1200&auto=format&fit=crop"},
  {name:"كابتشينو موكا بونجورنو", price:30, img:"https://kitchen.sayidaty.net/uploads/small/bd/bd6fe84636e832188966978d0b33df89_w240_h240.jpg"},
  {name:"كابتشينو بندق", price:30, img:"https://png.pngtree.com/background/20230606/original/pngtree-cappuccino-with-hazelnuts-on-wooden-background-cappuccino-with-chocolate-powder-on-picture-image_2877924.jpg"},
  {name:"كابتشينوموكا بريك", price:30, img:"https://kitchen.sayidaty.net/uploads/small/7f/7f77c9da149c6b1ade121eaafb8b2d32_w240_h240.jpg"},
  {name:"مشروب كاكاو", price:20, img:"https://kitchen.sayidaty.net/uploads/small/07/074968944610cfa33478d4624f3acf6c_w750_h750.jpg"},
  {name:"قرفه", price:15, img:"https://www.mklat.com/wp-content/uploads/images-2020-02-07T132118.495.jpeg"},
  {name:"ينسون ليمون", price:15, img:"https://img.lahloba.com/news/medium/88024614-091a-4d49-b092-3ac8c0acc7c2.jpg"},
  {name:"جنزبيل", price:15, img:"https://cdn.salla.sa/yoeEO/ll7lBNPY1Y5zNevmsPBGPeNmMDTdZ3WOaAxsaE37.jpg"},
  {name:"قهوه بندق", price:30, img:"https://static.webteb.net/images/content/tbl_articles_article_23876_135217fbcdf-3d66-4ed6-8186-02e4ca3ede72.jpg"},
  {name:"شاي فتله", price:10, img:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSLuxjxoldW8YwXW9u16XAY7Mts3vxFITLC5w-LnAXxnEd7py4hfqMNx0Yd3TKbleQbNSc&usqp=CAU"},
  {name:"شاي", price:10, img:"https://ichef.bbci.co.uk/ace/ws/640/cpsprodpb/2AAE/production/_108962901_hi053405374.jpg.webp"},
  {name:"قهوه سادة", price:25, img:"https://i1.sndcdn.com/artworks-000219824277-bq4b2z-t500x500.jpg"},
  {name:"قهوه وسط", price:25, img:"https://media.dotmsr.com/large/20180510012305235.jpg"},
  {name:"قهوه فاتح", price:25, img:"https://cdn.altibbi.com/cdn/cache/xlarge/image/2020/08/31/26e99794e2cbc565a80ef65d323fd976.png.webp"},
  {name:"قهوه اسبيرسو", price:30, img:"https://cdn.salla.sa/zvPYx/bxmAiNbJcGBNoOPBs9O9RlRyxb5no55zJn3TBMPE.jpg"},
  {name:"سن توب برتقال", price:15, img:"https://m.media-amazon.com/images/I/916EviIV6mL._UF350,350_QL80_.jpg"},
  {name:"سن توب مانجا", price:15, img:"https://gomla-eg.com/image/cache/catalog/products/115.2.png-242x433.png.webp"},
  {name:"سن توب ليمون", price:15, img:"https://cdn.mafrservices.com/pim-content/EGY/media/product/645014/1753792204/645014_main.jpg"},
  {name:"جهينه جوافه", price:10, img:"https://cdn.mafrservices.com/sys-master-root/h56/h7e/26751925026846/3701_main.jpg"},
  {name:"جهينه تفاح", price:10, img:"https://cdn.mafrservices.com/sys-master-root/h75/h81/26751941378078/433828_main.jpg"},
  {name:"في كولا", price:15, img:"https://m.media-amazon.com/images/I/61dmTQPVy7L._UF350,350_QL80_.jpg"},
  {name:"في كولا توت", price:15, img:"https://mir-s3-cdn-cf.behance.net/projects/404/b3baf6172080833.Y3JvcCwxOTIzLDE1MDQsNzEsMTYx.jpg"},
  {name:"تويست", price:15, img:"https://m.media-amazon.com/images/I/518JZuXq+rL._UF894,1000_QL80_.jpg"},
  {name:"سباتس برتقال", price:12, img:"https://mir-s3-cdn-cf.behance.net/projects/404/141a34190709179.Y3JvcCwyMDg4LDE2MzMsMCw1NjM.jpg"},
  {name:"مياه", price:6, img:"https://www.hayat.sa.com/hayat/img/slide1.jpg"},
  {name:"نعناع", price:15, img:"https://t4.ftcdn.net/jpg/00/98/14/57/240_F_98145756_6KE4xOrzwxOOXBg3jNiy6ibih6LZNdYK.jpg"},
  {name:"كركديه", price:10, img:"https://t4.ftcdn.net/jpg/03/04/01/51/240_F_304015124_A0kGlJa8qRpIEfJPPTanpClZ9dHEuqpu.jpg"},
  {name:"ليمون نعناع", price:20, img:"https://t3.ftcdn.net/jpg/02/91/91/98/240_F_291919807_sNDDdCxZMztrZATDzG0vHpB3uYet3Zsm.jpg"},
  {name:"في كولا سفن", price:15, img:"https://bf1af2.akinoncloudcdn.com/products/2025/03/25/356847/382ee71e-19bf-4744-b872-56d816980b0e_size3840_cropCenter.jpg"},
  {name:"عصير مكس جهينه", price:15, img:"https://www.juhayna.com/app/uploads/2018/12/1595866123_393_2126394_chocomixside2-400x794.png"}
];

const snacks = [
  {name:"كبك كيك تودو", price:15, img:"https://images.squarespace-cdn.com/content/v1/5fd9ff13116da748d1fb387c/e25cc4b1-c2dd-4886-b48e-1acc29ec5872/todo-cupcakes-2.jpg"},
  {name:"كبك كيك ريد", price:15, img:"https://images.squarespace-cdn.com/content/v1/5fd9ff13116da748d1fb387c/e25cc4b1-c2dd-4886-b48e-1acc29ec5872/todo-cupcakes-2.jpg"},
  {name:"هوهوز شيكولاته", price:10, img:"https://m.media-amazon.com/images/I/61xJwOh51DL._UF894,1000_QL80_.jpg"},
  {name:"هوهوز فراوله", price:10, img:"https://m.media-amazon.com/images/S/aplus-media/sota/629e0dad-619f-453a-9b6d-593c81b0dafb.__CR0,0,300,300_PT0_SX300_V1___.jpg"},
  {name:"هوهوز كريمه", price:10, img:"https://m.media-amazon.com/images/S/aplus-media/sota/629e0dad-619f-453a-9b6d-593c81b0dafb.__CR0,0,300,300_PT0_SX300_V1___.jpg"},
  {name:"تودو بومب", price:15, img:"https://cdn.mafrservices.com/sys-master-root/h7c/h47/49986430074910/450292_main.jpg"},
  {name:"تودو براوني", price:15, img:"https://thetasteofegypt.com/cdn/shop/products/file.png?v=1626159154"},
  {name:"توينكز ش وك", price:10, img:"https://images-na.ssl-images-amazon.com/images/I/31dY8v2lqZL._SL500_._AC_SL500_.jpg"},
  {name:"توينكز ف وك", price:10, img:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSSOUVFeDpsB385g70ET4FKmMxymSejHEu8_VyKmWYY6l644UvaugADdAw1VUBd1MTpplY&usqp=CAU"},
  {name:"توينكز سوبر ش", price:10, img:"https://images-na.ssl-images-amazon.com/images/I/31dY8v2lqZL._SL500_._AC_SL500_.jpg"},
  {name:"توينكزسوبر ف", price:10, img:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSSOUVFeDpsB385g70ET4FKmMxymSejHEu8_VyKmWYY6l644UvaugADdAw1VUBd1MTpplY&usqp=CAU"},
  {name:"توينكز دبل ك", price:10, img:"https://m.media-amazon.com/images/I/6144UtFOGvL._AC_SX679_.jpg"},
  {name:"توينكز ايسنج", price:10, img:"https://m.media-amazon.com/images/I/618VfzhZ6lL._AC_SX679_.jpg"},
  {name:"هوهوز ش كبير", price:10, img:"https://cdn.mafrservices.com/sys-master-root/hf9/h8a/50537935929374/617873_main.jpg?im=Resize=480"},
  {name:"شيبسي روو", price:15, img:"https://images-na.ssl-images-amazon.com/images/I/618+by-jxSL._SL500_._AC_SL500_.jpg"},
  {name:"بيك رولز ك", price:10, img:"https://m.media-amazon.com/images/I/71FBAhOZnVL._AC_SX679_.jpg"},
  {name:"بيك رولز جبنه", price:10, img:"https://m.media-amazon.com/images/I/71L42GIxo6L._UF894,1000_QL80_.jpg"},
  {name:"بيك رولز شطه", price:10, img:"https://m.media-amazon.com/images/I/71RS95-QpsL._UF894,1000_QL80_.jpg"},
  {name:"فرسكا فنجرز", price:10, img:"https://cdn.mafrservices.com/pim-content/EGY/media/product/636719/1733151604/636719_main.jpg"},
  {name:"فرسكا ستكس", price:5, img:"https://m.media-amazon.com/images/I/61OUCDWipQL.jpg"},
  {name:"اونيرو شوكو لافا", price:10, img:"https://m.media-amazon.com/images/I/71vohmufzML._UF894,1000_QL80_.jpg"},
  {name:"اونيرو لوتس", price:10, img:"https://m.media-amazon.com/images/I/911UEaEFaUL._AC_UL480_FMwebp_QL65_.jpg"},
  {name:"اونيرو بيضاء", price:10, img:"https://m.media-amazon.com/images/I/71a8qtaPWBL._UF894,1000_QL80_.jpg"},
  {name:"اونيرو ساده", price:10, img:"https://m.media-amazon.com/images/I/81hNVPF+EwL._AC_UL480_FMwebp_QL65_.jpg"},
  {name:"فرسكا ش", price:10, img:"https://www.qebox.app/qebox/wp-content/uploads/2025/05/Untitled-1-0%D9%A1-6-600x600.png"},
  {name:"فريسكا بلوك", price:8, img:"https://cdn.mafrservices.com/sys-master-root/h98/h44/49986436595742/545032_main.jpg"},
  {name:"مولتو شكولاته", price:10, img:"https://m.media-amazon.com/images/I/71rfa+-jI1L._UF894,1000_QL80_.jpg"},
  {name:"مولتو فراوله", price:10, img:"https://m.media-amazon.com/images/I/51WfZ3Y5PML._UF894,1000_QL80_.jpg"},
  {name:"مولتو ميكس", price:10, img:"https://cdn.mafrservices.com/sys-master-root/h56/h71/63006024138782/629904_main.jpg"},
  {name:"فيشار بيتزا", price:10, img:"https://m.media-amazon.com/images/I/61STd0taBTL._UF894,1000_QL80_.jpg"},
  {name:"فيشار جبنه", price:10, img:"https://m.media-amazon.com/images/I/61HheiXpeXL._UF894,1000_QL80_.jpg"},
  {name:"فيشار جبنه متبله", price:10, img:"https://m.media-amazon.com/images/I/610q6LBSbZL._UF894,1000_QL80_.jpg"},
  {name:"فيشار طماطم", price:10, img:"https://m.media-amazon.com/images/I/61rKSJ3ZKHL._UF894,1000_QL80_.jpg"},
  {name:"فيشار شطه", price:10, img:"https://m.media-amazon.com/images/I/613w7sXm2rL._UF894,1000_QL80_.jpg"},
  {name:"فيشار باربكيو", price:10, img:"https://m.media-amazon.com/images/I/41sBCXI4AeS._UF894,1000_QL80_.jpg"},
  {name:"سناكس", price:10, img:"https://m.media-amazon.com/images/I/61PXQpibuBL._UF894,1000_QL80_.jpg"},
  {name:"شيبسي soul ملح", price:10, img:"https://m.media-amazon.com/images/I/71vIsp2kr2L._AC_SY300_SX300_QL70_ML2_.jpg"},
  {name:"اندومي كبير", price:10, img:"https://m.media-amazon.com/images/I/61I5xrMOS7L._AC_SY300_SX300_QL70_ML2_.jpg"},
  {name:"اندومي صغير", price:5, img:"https://m.media-amazon.com/images/I/41f-8OER9bL._AC_.jpg"}
];

/* === حالة السلة (كمية لكل منتج) === */
const state = {}; // { "اسم المنتج": {qty, price} }

/* DOM refs */
const drinksGrid = document.getElementById('drinksGrid');
const snacksGrid = document.getElementById('snacksGrid');
const itemsCountEl = document.getElementById('itemsCount');
const liveTotalEl = document.getElementById('liveTotal');
const viewSummaryBtn = document.getElementById('viewSummary');
const clearBtn = document.getElementById('clearBtn');
const summaryBox = document.getElementById('summaryBox');
const summaryList = document.getElementById('summaryList');
const summaryTotalEl = document.getElementById('summaryTotal');
const sendBtn = document.getElementById('sendBtn');
const editBtn = document.getElementById('editBtn');
const searchInput = document.getElementById('searchInput');
const confirmBtn = document.getElementById('confirmBtn'); // not used but kept

/* === Helper functions === */
function idFromName(name){ return encodeURIComponent(name).replace(/%/g,''); }

function createCard(item){
  const id = idFromName(item.name);
  const div = document.createElement('div');
  div.className = 'card';
  div.dataset.name = item.name;
  div.innerHTML = `
    <img src="${item.img}" alt="${item.name}" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1492724441997-5dc865305da7?q=80&w=1200&auto=format&fit=crop'">
    <div class="name">${item.name}</div>
    <div class="price">${item.price} ج.م</div>
    <div class="qty-row">
      <button class="qty-btn" data-action="dec" data-name="${item.name}">−</button>
      <div class="qty-display" id="qty_${id}">0</div>
      <button class="qty-btn" data-action="inc" data-name="${item.name}">+</button>
    </div>
  `;
  return div;
}

function renderAll(){
  drinks.forEach(it=>drinksGrid.appendChild(createCard(it)));
  snacks.forEach(it=>snacksGrid.appendChild(createCard(it)));
  document.querySelectorAll('.qty-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const name = btn.dataset.name;
      const delta = btn.dataset.action === 'inc' ? 1 : -1;
      changeQty(name, delta);
    });
  });
}

/* تعديل الكمية */
function changeQty(name, delta){
  if(!state[name]) state[name] = { qty:0, price: findPrice(name) };
  state[name].qty = Math.max(0, state[name].qty + delta);
  const el = document.getElementById('qty_'+idFromName(name));
  if(el) el.textContent = state[name].qty;
  updateLiveSummary();
}

/* إيجاد السعر */
function findPrice(name){
  const f1 = drinks.find(d=>d.name===name);
  if(f1) return f1.price;
  const f2 = snacks.find(s=>s.name===name);
  if(f2) return f2.price;
  return 0;
}

/* تحديث الإحصائية الحية */
function updateLiveSummary(){
  let itemsCount = 0, total = 0;
  for(const [name,obj] of Object.entries(state)){
    if(obj.qty <= 0) continue;
    itemsCount += obj.qty;
    total += obj.qty * obj.price;
  }
  itemsCountEl.textContent = itemsCount;
  liveTotalEl.textContent = total;
}

/* بناء مصفوفة العناصر للارسال/العرض */
function buildItemsArray(){
  const items = [];
  for(const [name,obj] of Object.entries(state)){
    if(obj.qty <= 0) continue;
    const unit = obj.price || 0;
    const qty = obj.qty;
    const lineTotal = unit * qty;
    items.push({ name: name, qty: qty, unitPrice: unit, lineTotal: lineTotal });
  }
  return items;
}

/* عرض الملخص قبل الإرسال */
viewSummaryBtn.addEventListener('click', ()=>{
  const customer = document.getElementById('customerName').value.trim();
  const phone = document.getElementById('customerPhone').value.trim();
  if(!customer || !phone){ alert('الرجاء إدخال اسم العميل ورقم الهاتف قبل عرض التفاصيل'); return; }

  const items = buildItemsArray();
  if(items.length === 0){ alert('السلة فارغة — أضف منتجات أولاً'); return; }

  let html = '';
  let total = 0;
  items.forEach(it=>{
    html += `<div>${it.name} × ${it.qty} — ${it.unitPrice} ج.م (المجموع: ${it.lineTotal} ج.م)</div>`;
    total += it.lineTotal;
  });
  summaryList.innerHTML = html;
  summaryTotalEl.textContent = total;
  summaryBox.classList.remove('hidden');
  window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'});
});

/* زر تعديل (العودة لواجهة الاختيار) */
editBtn.addEventListener('click', ()=>{
  summaryBox.classList.add('hidden');
});

/* مسح السلة */
clearBtn.addEventListener('click', ()=>{
  for(const k of Object.keys(state)){ state[k].qty = 0; const el = document.getElementById('qty_'+idFromName(k)); if(el) el.textContent='0'; }
  updateLiveSummary();
});

/* فلترة البحث */
searchInput.addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase();
  document.querySelectorAll('.card').forEach(card=>{
    const name = (card.dataset.name||'').toLowerCase();
    card.style.display = name.includes(q) ? '' : 'none';
  });
});

/* إرسال الطلب — كل منتج في صف مستقل (عمودي) */
sendBtn.addEventListener('click', async ()=>{
  const customer = document.getElementById('customerName').value.trim();
  const phone = document.getElementById('customerPhone').value.trim();
  if(!customer || !phone){ alert('الرجاء إدخال اسم العميل ورقم الهاتف'); return; }

  const items = buildItemsArray();
  if(items.length === 0){ alert('السلة فارغة — أضف منتجات أولاً'); return; }

  const total = items.reduce((s,it)=>s+it.lineTotal, 0);

  // payload as FormData to avoid preflight and ensure Apps Script يحصل على e.parameter.items
  const form = new FormData();
  form.append('name', customer);
  form.append('phone', phone);
  form.append('items', JSON.stringify(items)); // array of {name, qty, unitPrice, lineTotal}
  form.append('total', String(total));

  // disable UI while sending
  sendBtn.disabled = true;
  sendBtn.textContent = 'جاري الإرسال...';

  try {
    const res = await fetch(WEB_APP_URL, {
      method: 'POST',
      body: form
    });

    // محاولة قراءة JSON (بعض إعدادات web app قد تمنع قراءة response؛ لكن الإرسال يتم)
    let json = null;
    try { json = await res.json(); } catch(e){ /* ignore */ }

    // بعد الإرسال بنجاح، إعادة تهيئة السلة
    alert('✅ تم إرسال الطلب إلى Google Sheets' + (json && json.orderId ? '\nرقم الطلب: ' + json.orderId : ''));
    // reset
    for(const k of Object.keys(state)){ state[k].qty = 0; const el = document.getElementById('qty_'+idFromName(k)); if(el) el.textContent='0'; }
    updateLiveSummary();
    summaryBox.classList.add('hidden');
  } catch(err){
    console.error('Send error', err);
    alert('فشل إرسال الطلب. تحقق من الإنترنت ومن إعداد Web App. (انظر Console للمزيد)');
  } finally {
    sendBtn.disabled = false;
    sendBtn.textContent = 'تأكيد وإرسال الطلب';
  }
});

/* init */
renderAll();
updateLiveSummary();
</script>
</body>
</html>
